# JesterOS Build Configuration
# Build-time settings and toolchain configuration
# This file is sourced by build scripts and Makefiles

# ============================================================================
# KERNEL CONFIGURATION
# ============================================================================
KERNEL_VERSION="2.6.29-jester"
KERNEL_BASE="Linux 2.6.29"
KERNEL_CONFIG="omap3621_gossamer_evt1c_defconfig"
KERNEL_IMAGE="uImage"
KERNEL_LOAD_ADDR="0x80008000"
KERNEL_ENTRY_ADDR="0x80008000"

# ============================================================================
# TOOLCHAIN CONFIGURATION
# ============================================================================
TOOLCHAIN_PREFIX="arm-linux-androideabi"
TOOLCHAIN_VERSION="4.9"
NDK_VERSION="r10e"
NDK_PLATFORM="android-9"
CROSS_COMPILE="${TOOLCHAIN_PREFIX}-"
ARCH="arm"
CC="${CROSS_COMPILE}gcc"
LD="${CROSS_COMPILE}ld"
AR="${CROSS_COMPILE}ar"
STRIP="${CROSS_COMPILE}strip"

# ============================================================================
# DOCKER BUILD ENVIRONMENT
# ============================================================================
DOCKER_IMAGE="quillkernel-builder"
DOCKER_TAG="latest"
DOCKER_FULL="${DOCKER_IMAGE}:${DOCKER_TAG}"
DOCKER_WORKDIR="/build"
DOCKER_UID="1000"
DOCKER_GID="1000"

# ============================================================================
# BUILD PATHS
# ============================================================================
BUILD_ROOT="${PWD}"
KERNEL_SRC="${BUILD_ROOT}/nst-kernel-base/src"
MODULE_SRC="${BUILD_ROOT}/quillkernel/modules"
OUTPUT_DIR="${BUILD_ROOT}/output"
FIRMWARE_DIR="${BUILD_ROOT}/firmware"
BOOT_DIR="${FIRMWARE_DIR}/boot"

# ============================================================================
# INSTALLATION PATHS (on target device)
# ============================================================================
INSTALL_PREFIX="/boot"
MODULE_INSTALL_PATH="/lib/modules/2.6.29"
CONFIG_INSTALL_PATH="/etc/jesteros"
DATA_INSTALL_PATH="/var/lib/jesteros"
MANUSCRIPT_PATH="/root/manuscripts"
NOTES_PATH="/root/notes"
DRAFTS_PATH="/root/drafts"

# ============================================================================
# BUILD OPTIONS
# ============================================================================
PARALLEL_JOBS="$(nproc)"
VERBOSE_BUILD="false"
DEBUG_BUILD="false"
STRIP_MODULES="true"
COMPRESS_MODULES="false"
OPTIMIZE_SIZE="true"
ENABLE_CCACHE="true"

# ============================================================================
# MODULE BUILD OPTIONS
# ============================================================================
MODULE_LICENSE="GPL"
MODULE_SIGNING="false"
MODULE_COMPRESS="false"
MODULE_STRIP="true"

# ============================================================================
# ROOTFS OPTIONS
# ============================================================================
ROOTFS_TYPE="ext4"
ROOTFS_SIZE="31MB"
ROOTFS_COMPRESSION="gzip"
DEBIAN_VERSION="bullseye"
DEBIAN_ARCH="armel"

# ============================================================================
# SD CARD CONFIGURATION
# ============================================================================
SD_BOOT_SIZE="50M"
SD_BOOT_FS="vfat"
SD_ROOT_SIZE="200M"
SD_ROOT_FS="ext4"
SD_DATA_SIZE="remaining"
SD_DATA_FS="ext4"

# ============================================================================
# BUILD FLAGS
# ============================================================================
CFLAGS="-O2 -march=armv7-a -mtune=cortex-a8 -mfpu=neon -mfloat-abi=softfp"
LDFLAGS="-Wl,-O1 -Wl,--hash-style=gnu"
KERNEL_CFLAGS="-Os -fno-strict-aliasing -fno-common"
MODULE_CFLAGS="-DMODULE -fno-pic"

# ============================================================================
# TESTING OPTIONS
# ============================================================================
RUN_TESTS="true"
TEST_COVERAGE="90"
TEST_TIMEOUT="300"
SMOKE_TEST="true"

# ============================================================================
# RELEASE OPTIONS
# ============================================================================
SIGN_RELEASES="false"
RELEASE_COMPRESSION="tar.gz"
RELEASE_NAMING="${PROJECT_NAME}-${VERSION_STRING}-${DEVICE_CODENAME}"
CHECKSUM_TYPE="sha256"